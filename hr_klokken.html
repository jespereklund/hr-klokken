<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="./seven-segment" rel="stylesheet">
    <title>Hr Klokken</title>
</head>
<body>
    <script>
        const talTimes = {
            "og0"  : 0,
            "og10" : 1.688,
            "og20" : 3.138,
            "og30" : 4.833,
            "og40" : 6.511,
            "og50" : 8.083,
            "0"    : 9.872,
            "1"    : 11.200,
            "2"    : 12.550,
            "3"    : 13.949,
            "4"    : 15.464,
            "5"    : 17.088,
            "6"    : 18.370,
            "7"    : 19.879,
            "8"    : 21.299,
            "9"    : 22.736,
            "10"   : 24.077,
            "11"   : 25.486,
            "12"   : 26.945,
            "13"   : 28.290,
            "14"   : 29.719,
            "15"   : 31.190,
            "16"   : 32.706,
            "17"   : 34.204,
            "18"   : 35.641,
            "19"   : 36.963,
            "20"   : 38.374,
            "21"   : 39.863,
            "22"   : 41.706,
            "23"   : 43.584,
            "24"   : 45.550,
            "25"   : 47.483,
            "26"   : 49.383,
            "27"   : 51.265,
            "28"   : 53.163,
            "29"   : 55.031,
            "30"   : 56.916,
            "31"   : 58.446,
            "32"   : 60.296,
            "33"   : 62.183,
            "34"   : 64.196,
            "35"   : 66.203,
            "36"   : 68.090,
            "37"   : 69.962,
            "38"   : 71.869,
            "39"   : 73.755,
            "40"   : 75.773,
            "41"   : 77.184,
            "42"   : 78.982,
            "43"   : 80.815,
            "44"   : 82.726,
            "45"   : 84.660,
            "46"   : 86.510,
            "47"   : 88.300,
            "48"   : 90.178,
            "49"   : 92.026,
            "50"   : 93.876,
            "51"   : 95.439,
            "52"   : 97.278,
            "53"   : 99.230,
            "54"   : 101.279,
            "55"   : 103.329,
            "56"   : 105.239,
            "57"   : 107.190,
            "58"   : 109.138,
            "59"   : 111.074,
            "duut" : 112.823
        }

        let tal = new Audio("tal.mp3")

        tal.addEventListener("loadeddata", (event) => {
            document.getElementById("startBtn").style.visibility = "visible"
        })

        let clock = new Date()
        let oldSecond = 0

        function startTimer() {
            setInterval(() => {
                let date = new Date()
                if (date.getSeconds() != oldSecond) {

                    //say digit
                    sayDigit(date)
                    oldSecond = date.getSeconds()

                    //clock display
                    clock = new Date()
                    document.getElementById("clock").innerHTML = clock.toTimeString().split(' ')[0]
                }
            }, 50)
        }

        function sayDigit(date) {
            switch(date.getSeconds()) {

                // duut
                case 0: case 10: case 20: case 30: case 40: case 50:
                    say("duut")
                    break

                // Hours
                case 4: case 14: case 24: case 34: case 44: case 54:
                    if(date.getMinutes() === 59 && date.getSeconds() === 54) {
                        say((date.getHours() + 1) % 24)
                    } else {
                        say(date.getHours())
                    }
                    break

                // Minutes
                case 6: case 16: case 26: case 36: case 46:
                    say(date.getMinutes())
                    break

                case 56:
                    say((date.getMinutes() + 1) % 60)
                    break

                // Seconds
                case 8: case 18: case 28: case 38: case 48:
                    say("og" + Number(date.getSeconds() + 2))
                    break

                case 58:
                    say("og0")
                    break
            }
        }

        function say(sample) {
            tal.currentTime = talTimes[sample] - 0.1
            tal.play()
            setTimeout(
                stopAudio,
                1500
            )
        }

        function stopAudio() {
            tal.pause();
            tal.currentTime = 0;
        }

        function start() {
            document.getElementById("content").style.visibility = "visible"
            document.getElementById("startBtn").style.visibility = "hidden"
            startTimer()
        }
            
    </script>
    <button id="startBtn" style="visibility: hidden;" onclick="start()">Start Hr Klokken</button>
    <div id="content" style="visibility: hidden; background-color: black; width: 230px; height: 80px;">
        <p id="clock" style="font-size: 60px; font-family: 'Seven Segment'; color: crimson; font-style: italic; padding: 10px;"></p>
    </div>        
</body>
</html>